package com.recalot.model.experiments.access;

import com.recalot.common.GenericServiceListener;
import com.recalot.common.exceptions.BaseException;
import com.recalot.common.interfaces.model.experiment.DataSplitter;
import org.osgi.framework.BundleContext;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.ConcurrentHashMap;

/**
 * Created by matthaeus.schmedding on 16.04.2015.
 */
public class DataSplitterAccess implements com.recalot.common.interfaces.model.experiment.DataSplitterAccess {
    private final BundleContext context;
    private final GenericServiceListener<DataSplitter> dataSplitterListener;
    private final ConcurrentHashMap<String, DataSplitter> dataSplitter;

    public DataSplitterAccess(BundleContext context){
        this.context = context;
        this.dataSplitterListener = new GenericServiceListener<>(context, DataSplitter.class.getName());
        this.dataSplitter = new ConcurrentHashMap<>();

        this.context.addServiceListener(dataSplitterListener);
    }

    @Override
    public DataSplitter getDataSplitter(String id) throws BaseException {
        return dataSplitterListener.getInstance(id);
    }

    @Override
    public List<DataSplitter> getDataSplitters() throws BaseException {
        return new ArrayList<>(dataSplitterListener.getAll());
    }

    @Override
    public String getKey() {
        return "datasplitter-access";
    }

    @Override
    public String getDescription() {
        return null;
    }

    @Override
    public void close() throws IOException {

    }
}
