package com.recalot.unittests;

import com.recalot.unittests.helper.WebRequest;
import com.recalot.unittests.helper.WebResponse;
import org.junit.Before;

import java.util.Hashtable;
import java.util.Map;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

/**
 * Created by matthaeus.schmedding on 24.04.2015.
 */
public class TestsBase {

    public static String HOST = "http://localhost:8080/";
    public static String SourcesPath = "sources/";
    public static String SourceId = "mysql-test";
    public static String PathSeparator = "/";

    public boolean isConnected = false;


    @Before
    public void checkIfSQLIsConnectedAndConnectIfNot() {

        if (!isConnected) {
            try {

                WebResponse response = WebRequest.execute(HOST + SourcesPath + SourceId);
                assertNotNull(response);

            } catch (Exception e) {
                Map<String, String> params = new Hashtable<>();
                params.put("data-builder-id", "mysql");
                params.put("source-id", "mysql-test");
                params.put("sql-server", "mysql://localhost:3306");
                params.put("sql-database", "recalot.com_test");
                params.put("sql-username", "root");
                params.put("sql-password", "mysqlpassword");

                WebResponse response = WebRequest.execute(WebRequest.HTTPMethod.PUT, HOST + SourcesPath, params);

                assertNotNull(response);
                assertEquals(response.getContentType(), "application/json");
                assertNotNull(response.getBody());
                assertEquals(response.getResponseCode(), 200);
            }

            isConnected = true;
        }
    }
}
